## 기술 계획 및 리뷰 (Technical Plan & Review)

이 문서는 Navo 프로젝트의 핵심 기술 원칙, 아키텍처 방향성, 그리고 지속적으로 관리해야 할 기술 부채 및 개선사항을 요약합니다.

- **핵심 방향성**: 사용자가 “Wow”라고 느끼는 결과물 지향. 생성이 아니라 완성된 제품 전달에 초점.
- **아키텍처 원리**: Tools → Plans(DAG) → Generic Executor. AI는 계획(그래프) 생성, 실행기는 수행/관측/복구 담당.
- **배포 기준**: 프론트는 Vercel, 백엔드와 Postgres는 Render.
- **코드 원칙**: 수직 슬라이스(기능 단위), 엄격한 모듈 경계, 단방향 흐름, 중앙화된 설정.

- **강점**: 실행 로그/트레이스 중심의 관측성, 단계별 로드맵 명료.
- **리스크/주의**:
  - DAG 계획 품질(의존성/병렬성/실패 경로)과 도구 선택의 복잡도
  - Auto-Error Resolution 신뢰도(거짓 양/음성, 루프 위험)
  - 벤더 종속성(Vercel/Render), 비용/지연 관리, 스키마/프롬프트 버저닝

- **에이전트 행동 지침**:
  - Tool/Plan 계약(스키마, 입력/출력, idempotency)을 엄격히 준수
  - DAG에 의존성/병렬성/실패 분기를 명시하고 재시도·롤백 설계 포함
  - 모듈 경계 위반 금지; 공유 코드는 `packages/shared` 활용
  - 관측성: 요청 Trace ID, 실패율/레이턴시/재시도 지표 기록
  - 보안/시크릿: ENV 사용, 하드코딩 금지, 최소 권한 원칙

- **핵심 목표(P0)**:
  - **최소 자가 치유(Self-Healing) E2E 시나리오 완주:** 치명적 오류 발생 시, AI가 스스로 원인을 분석하고 해결책을 제안(또는 실행)하는 워크플로우를 최소 기능으로 구현.
  - **Tool/Plan 스키마 버전 관리:** AI가 사용하는 도구와 계획의 스키마를 안정적으로 관리하고 버저닝하는 체계 확립.
  - **배포 파이프라인 표준화:** IaC(Infrastructure as Code) 및 환경 변수 관리 표준을 확정하여 배포 안정성 확보.

- **관련 문서**:
  - [000_master_plan.md](./000_master_plan.md)
  - [001_unified_roadmap.md](./001_unified_roadmap.md)
  - [002_architectural_vision.md](./002_architectural_vision.md)

---

## Action Items (Technical Debt & Refactoring)

이 목록은 프로젝트의 장기적인 안정성과 확장성을 위해 해결해야 할 기술 부채 및 개선사항을 추적합니다.

-   [x] **CSS 스코프 정리:** `ai-agent.css`와 `ChatSection.css`의 중복 셀렉터를 분리하고 역할을 명확히 함. (완료)
-   [ ] **VFS 동기화 전략 고도화:** 현재의 '전체 삭제 후 생성' 방식을 파일/폴더의 변경사항만 반영하는 Diff 기반 또는 Upsert 방식으로 개선.
-   [ ] **채팅 페이징 커서 안정화:** 동일 타임스탬프 메시지 처리 시 발생할 수 있는 중복/누락 문제를 해결하기 위해 `(createdAt, id)` 복합 커서 또는 더 정밀한 범위 기반 쿼리 적용.
-   [ ] **큰 파일 응답 보호 장치:** AI가 생성하는 파일 `content`의 크기 상한을 설정하고, 초과 시 사용자에게 명확한 피드백을 제공하는 로직 추가.
-   [ ] **활성 탭 상태 관리 개선:** 파일 삭제(`useDeleteVfsNode`) 후, 다른 탭이 있음에도 활성 탭이 `null`이 될 수 있는 엣지 케이스를 방지하기 위해 `setActiveFile` 호출 로직 개선.

## QA Checklist

이 체크리스트는 새로운 기능을 배포하거나 주요 리팩토링을 수행한 후 반드시 검증해야 할 핵심 사용자 시나리오를 포함합니다.

-   [ ] **채팅 페이징:** 긴 대화 기록에서 채팅창을 위로 스크롤했을 때, 이전 대화 내용이 중복되거나 누락되지 않고 자연스럽게 이어지는가?
-   [ ] **채팅 자동 스크롤:** 새로운 메시지를 보내거나 받았을 때, 채팅창이 부드럽게 최하단으로 스크롤되는가? (사용자가 위를 보고 있을 때는 제외)
-   [ ] **채팅 입력 상태:** AI가 작업 중일 때 입력창과 전송 버튼이 명확히 비활성화되고, 작업이 끝나면 다시 활성화되는가?
-   [ ] **VFS 동기화:** AI에게 기존 파일 구조의 변경(이름 변경, 파일 삭제, 폴더 이동 등)을 포함하는 새로운 아키텍처를 적용하도록 요청했을 때, 변경사항이 정확히 반영되는가? (현재는 추가만 됨)
-   [ ] **파일 CRUD 안정성:** 파일/폴더를 생성, 조회, 수정, 삭제하는 과정에서 다른 파일이나 폴더에 영향을 주지 않으며, 데이터 정합성이 유지되는가?
-   [ ] **문서와 실제 경험의 일치:** `000_master_plan.md`에 기술된 사용자 여정과 실제 제품의 UX 플로우가 일치하는가?
