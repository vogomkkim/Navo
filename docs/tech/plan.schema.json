{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Navo AI Task Plan",
  "description": "Defines the structure of a plan generated by the Navo AI planner, outlining the steps to fulfill a user request.",
  "type": "object",
  "required": ["planId", "steps"],
  "properties": {
    "planId": {
      "description": "A unique identifier for this plan.",
      "type": "string",
      "format": "uuid"
    },
    "userRequest": {
      "description": "The original natural language request from the user.",
      "type": "string"
    },
    "summary": {
      "description": "A brief, natural language summary of the plan.",
      "type": "string"
    },
    "steps": {
      "description": "An array of steps to be executed in order.",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Step"
      }
    }
  },
  "definitions": {
    "Step": {
      "type": "object",
      "required": ["stepId", "toolName", "summary"],
      "properties": {
        "stepId": {
          "type": "string"
        },
        "toolName": {
          "description": "The name of the tool to execute for this step.",
          "type": "string",
          "enum": [
            "code_generator",
            "file_writer",
            "shell_command",
            "user_prompt"
          ]
        },
        "summary": {
          "description": "A natural language description of what this step does.",
          "type": "string"
        },
        "backendRequired": {
          "description": "If true, this step involves backend code generation or modification.",
          "type": "boolean",
          "default": false
        },
        "reason": {
          "description": "The reason why backend modification is required for this step.",
          "type": "string"
        },
        "parameters": {
          "description": "The parameters to pass to the tool.",
          "type": "object",
          "properties": {
            "apiBlueprint": {
              "description": "The API blueprint, only present if toolName is 'code_generator'.",
              "$ref": "api-blueprint.schema.json"
            },
            "filePath": {
              "type": "string"
            },
            "content": {
              "type": "string"
            },
            "command": {
              "type": "string"
            }
          }
        }
      },
      "if": {
        "properties": { "backendRequired": { "const": true } }
      },
      "then": {
        "required": ["reason"]
      }
    }
  }
}
