<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Navo - Login</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .login-container {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 400px;
      }
      .logo {
        text-align: center;
        margin-bottom: 2rem;
      }
      .logo h1 {
        color: #333;
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
      }
      .form-group {
        margin-bottom: 1.5rem;
      }
      label {
        display: block;
        margin-bottom: 0.5rem;
        color: #555;
        font-weight: 500;
      }
      input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.2s;
        box-sizing: border-box;
      }
      input:focus {
        outline: none;
        border-color: #667eea;
      }
      button {
        width: 100%;
        padding: 0.75rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
      }
      button:hover {
        transform: translateY(-2px);
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      .error {
        color: #e74c3c;
        text-align: center;
        margin-top: 1rem;
        font-size: 0.9rem;
      }
      .success {
        color: #27ae60;
        text-align: center;
        margin-top: 1rem;
        font-size: 0.9rem;
      }

      /* Tab Styles */
      .tab-nav {
        display: flex;
        margin-bottom: 2rem;
        border-bottom: 2px solid #e1e5e9;
      }

      .tab-btn {
        flex: 1;
        padding: 1rem;
        background: none;
        border: none;
        font-size: 1rem;
        font-weight: 600;
        color: #666;
        cursor: pointer;
        transition: all 0.2s;
        border-bottom: 3px solid transparent;
      }

      .tab-btn.active {
        color: #667eea;
        border-bottom-color: #667eea;
      }

      .tab-btn:hover {
        color: #667eea;
        background: #f8f9fa;
      }

      /* Form Display */
      .form {
        display: none;
      }

      .form.active {
        display: block;
      }

      /* Name Input Group */
      .name-input-group {
        display: flex;
        gap: 0.5rem;
      }

      .name-input-group input {
        flex: 1;
        width: auto; /* Override the global width: 100% */
      }

      .generate-name-btn {
        padding: 0.5rem 1rem;
        background: #667eea;
        color: white;
        border: 1px solid #667eea;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s;
        white-space: nowrap;
      }

      .generate-name-btn:hover {
        background: #5a6fd8;
        border-color: #5a6fd8;
        transform: translateY(-1px);
      }

      .form-hint {
        color: #6c757d;
        font-size: 0.8rem;
        margin-top: 0.25rem;
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="login-container">
      <div class="logo">
        <h1>Navo</h1>
      </div>

      <!-- Tab Navigation -->
      <div class="tab-nav">
        <button class="tab-btn active" data-tab="login">Login</button>
        <button class="tab-btn" data-tab="register">Register</button>
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="form active">
        <div class="form-group">
          <label for="loginEmail">Email</label>
          <input
            type="email"
            id="loginEmail"
            name="email"
            required
            placeholder="Enter your email"
          />
        </div>
        <div class="form-group">
          <label for="loginPassword">Password</label>
          <input
            type="password"
            id="loginPassword"
            name="password"
            required
            placeholder="Enter your password"
          />
        </div>
        <button type="submit" id="loginBtn">Login</button>
      </form>

      <!-- Register Form -->
      <form id="registerForm" class="form">
        <div class="form-group">
          <label for="registerName">Name (Optional)</label>
          <div class="name-input-group">
            <input type="text" id="registerName" name="name" placeholder="" />
            <button
              type="button"
              id="generateNameBtn"
              class="generate-name-btn"
            >
              Generate
            </button>
          </div>
          <small class="form-hint"
            >Leave empty to use a random funny name</small
          >
        </div>
        <div class="form-group">
          <label for="registerEmail">Email</label>
          <input
            type="email"
            id="registerEmail"
            name="email"
            required
            placeholder="Enter your email"
          />
        </div>
        <div class="form-group">
          <label for="registerPassword">Password</label>
          <input
            type="password"
            id="registerPassword"
            name="password"
            required
            placeholder="Enter your password"
          />
        </div>
        <button type="submit" id="registerBtn">Register</button>
      </form>

      <div id="message"></div>
    </div>

    <script>
      const loginForm = document.getElementById('loginForm');
      const registerForm = document.getElementById('registerForm');
      const messageDiv = document.getElementById('message');
      const loginBtn = document.getElementById('loginBtn');
      const registerBtn = document.getElementById('registerBtn');
      const generateNameBtn = document.getElementById('generateNameBtn');
      const tabBtns = document.querySelectorAll('.tab-btn');

      // Check if user is already logged in
      const token = localStorage.getItem('navo_token');
      if (token) {
        window.location.href = '/';
      }

      // Generate random funny name
      function generateFunnyName() {
        const adjectives = [
          'Cosmic',
          'Quantum',
          'Ninja',
          'Cyber',
          'Mystic',
          'Epic',
          'Legendary',
          'Galactic',
          'Stealth',
          'Phantom',
          'Shadow',
          'Thunder',
          'Lightning',
          'Frost',
          'Flame',
          'Storm',
          'Void',
          'Echo',
          'Pulse',
          'Blitz',
          'Zen',
          'Chaos',
          'Order',
          'Nova',
          'Star',
          'Moon',
          'Sun',
          'Earth',
        ];

        const nouns = [
          'Penguin',
          'Dragon',
          'Phoenix',
          'Wolf',
          'Eagle',
          'Lion',
          'Tiger',
          'Shark',
          'Whale',
          'Dolphin',
          'Owl',
          'Hawk',
          'Falcon',
          'Raven',
          'Warrior',
          'Mage',
          'Archer',
          'Knight',
          'Wizard',
          'Sage',
          'Monk',
          'Ninja',
          'Samurai',
          'Viking',
          'Pirate',
          'Explorer',
          'Adventurer',
        ];

        const randomAdjective =
          adjectives[Math.floor(Math.random() * adjectives.length)];
        const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];

        return `${randomAdjective} ${randomNoun}`;
      }

      // Set initial placeholder with funny name
      const nameInput = document.getElementById('registerName');
      nameInput.placeholder = generateFunnyName();

      // Generate name button click handler
      generateNameBtn.addEventListener('click', () => {
        const newFunnyName = generateFunnyName();
        nameInput.value = newFunnyName;
        nameInput.placeholder = generateFunnyName(); // Update placeholder too
      });

      // Tab switching functionality
      tabBtns.forEach((btn) => {
        btn.addEventListener('click', () => {
          const tabName = btn.dataset.tab;

          // Update active tab button
          tabBtns.forEach((b) => b.classList.remove('active'));
          btn.classList.add('active');

          // Update active form
          document.querySelectorAll('.form').forEach((form) => {
            form.classList.remove('active');
          });
          document.getElementById(`${tabName}Form`).classList.add('active');

          // Clear messages
          messageDiv.textContent = '';
          messageDiv.className = '';
        });
      });

      // Login form submission
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        loginBtn.disabled = true;
        loginBtn.textContent = 'Logging in...';

        try {
          const response = await fetch('/api/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();

          if (data.ok && data.token) {
            // Store token in localStorage
            localStorage.setItem('navo_token', data.token);
            localStorage.setItem('navo_user', JSON.stringify(data.user));

            showMessage('Login successful! Redirecting...', 'success');

            // Redirect to main page
            setTimeout(() => {
              window.location.href = '/';
            }, 1000);
          } else {
            showMessage(data.error || 'Login failed', 'error');
          }
        } catch (error) {
          showMessage('Network error. Please try again.', 'error');
        } finally {
          loginBtn.disabled = false;
          loginBtn.textContent = 'Login';
        }
      });

      // Register form submission
      registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        let name = document.getElementById('registerName').value.trim();
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;

        // If name is empty, generate a random funny name
        if (!name) {
          name = generateFunnyName();
        }

        registerBtn.disabled = true;
        registerBtn.textContent = 'Creating account...';

        try {
          const response = await fetch('/api/register', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ name, email, password }),
          });

          const data = await response.json();

          if (data.ok) {
            showMessage(
              'Account created successfully! You can now login.',
              'success'
            );

            // Switch to login tab
            document.querySelector('[data-tab="login"]').click();

            // Clear register form
            registerForm.reset();
          } else {
            showMessage(data.error || 'Registration failed', 'error');
          }
        } catch (error) {
          showMessage('Network error. Please try again.', 'error');
        } finally {
          registerBtn.disabled = false;
          registerBtn.textContent = 'Register';
        }
      });

      function showMessage(text, type) {
        messageDiv.textContent = text;
        messageDiv.className = type;
      }
    </script>
  </body>
</html>
